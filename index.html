<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VT - ÊñáÂ≠óËΩ¨ËØ≠Èü≥Â∑•ÂÖ∑</title>
    <style>
        :root {
            --text-color: #2b2d42;
            --primary-color: #4361ee;
            --primary-light: #4895ef;
            --primary-dark: #3a56d4;
            --secondary-color: #7209b7;
            --success-color: #4cc9f0;
            --dark-color: #2b2d42;
            --light-color: #f8f9fa;
            --danger-color: #e63946;
            --warning-color: #ff9e00;
            --gray-color: #8d99ae;
            --border-color: #e0e0e0;
            --user-message-bg: var(--primary-color);
            --system-message-bg: #f0f2f5;
            --sidebar-bg: #ffffff;
            --header-bg: #ffffff;
            --input-bg: #ffffff;
            --shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            --transition: all 0.3s ease;
            --scrollbar-bg: rgba(0, 0, 0, 0.1);
            --border-radius: 12px;
            --card-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        /* ÊöóÈªëÊ®°Âºè */
        .dark-mode {
            --text-color: #f0f2f5;
            --dark-color: #f8f9fa;
            --light-color: #121212;
            --gray-color: #adb5bd;
            --border-color: #495057;
            --system-message-bg: #343a40;
            --sidebar-bg: #1e1e1e;
            --header-bg: #1e1e1e;
            --input-bg: #2d2d2d;
            --shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            --scrollbar-bg: rgba(255, 255, 255, 0.1);
            --card-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        ::-webkit-scrollbar {
            background-color: transparent;
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-thumb {
            background-color: var(--scrollbar-bg);
            border-radius: 8px;
        }

        ::selection {
            color: #000;
            background: rgba(255, 255, 255, .68)
        }

        body {
            font-family: 'Segoe UI', 'PingFang SC', 'Microsoft YaHei', Roboto, 'Helvetica Neue', Arial, sans-serif;
            height: 100vh;
            background-color: var(--light-color);
            display: flex;
            flex-direction: column;
            color: var(--text-color);
            line-height: 1.6;
        }

        .header {
            background-color: var(--header-bg);
            color: var(--dark-color);
            padding: 12px 20px;
            box-shadow: var(--shadow);
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 10;
            position: relative;
        }

        .header h1 {
            font-size: 1.3rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo-icon {
            font-size: 1.6rem;
            color: var(--primary-color);
        }

        .header-actions {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .theme-toggle {
            background: none;
            border: none;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
            color: var(--gray-color);
            font-size: 1.2rem;
        }

        .theme-toggle:hover {
            color: var(--primary-color);
            background-color: rgba(67, 97, 238, 0.1);
        }

        .dark-mode .theme-toggle:hover {
            background-color: rgba(67, 97, 238, 0.2);
        }

        .container {
            display: flex;
            flex: 1;
            overflow: hidden;
            position: relative;
        }

        /* Â∑¶‰æßÈü≥Ëâ≤ÂàóË°® */
        .voice-panel {
            width: 280px;
            background-color: var(--sidebar-bg);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transition: var(--transition);
        }

        .panel-header {
            padding: 16px 20px;
            font-weight: 600;
            background-color: var(--sidebar-bg);
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
        }

        .voice-search {
            padding: 12px 16px;
            border-bottom: 1px solid var(--border-color);
        }

        .search-input {
            width: 100%;
            padding: 10px 16px;
            border-radius: var(--border-radius);
            border: 1px solid var(--border-color);
            outline: none;
            font-size: 0.9rem;
            transition: var(--transition);
            background-color: var(--input-bg);
            color: inherit;
            box-shadow: var(--card-shadow);
        }

        .search-input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        }

        .voice-list {
            flex: 1;
            overflow-y: auto;
            padding: 8px 0;
        }

        .voice-item {
            padding: 14px 16px;
            margin: 0 8px 8px;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            flex-direction: column;
            background-color: var(--sidebar-bg);
            box-shadow: var(--card-shadow);
            border: 1px solid transparent;
        }

        .voice-item:hover {
            background-color: rgba(67, 97, 238, 0.05);
            border-color: rgba(67, 97, 238, 0.1);
            transform: translateY(-2px);
        }

        .dark-mode .voice-item:hover {
            background-color: rgba(67, 97, 238, 0.15);
        }

        .voice-item.active {
            background-color: rgba(67, 97, 238, 0.1);
            border-color: var(--primary-color);
            box-shadow: 0 0 0 1px var(--primary-color);
        }

        .dark-mode .voice-item.active {
            background-color: rgba(67, 97, 238, 0.2);
        }

        .voice-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
        }

        .voice-name {
            font-weight: 600;
            color: var(--dark-color);
            font-size: 0.95rem;
        }

        .voice-tag {
            background-color: var(--primary-light);
            color: white;
            font-size: 0.7rem;
            padding: 2px 8px;
            border-radius: 10px;
            font-weight: 500;
        }

        .voice-lang {
            font-size: 0.85rem;
            color: var(--gray-color);
            margin-bottom: 6px;
        }

        .voice-details {
            display: flex;
            gap: 8px;
            margin-top: 8px;
            font-size: 0.8rem;
            flex-wrap: wrap;
        }

        .voice-detail-item {
            background-color: var(--system-message-bg);
            padding: 4px 10px;
            border-radius: 12px;
            color: var(--gray-color);
            font-size: 0.75rem;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .voice-detail-item i {
            font-size: 0.7rem;
        }

        /* Âè≥‰æßËÅäÂ§©Âå∫Âüü */
        .chat-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
            background-color: var(--light-color);
        }

        .voice-info-bar {
            background: linear-gradient(90deg, var(--primary-light), var(--primary-color));
            color: var(--dark-color);
            padding: 12px 20px;
            font-size: 0.9rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow);
            border: 1px solid var(--primary-color);
            box-shadow: 0 0 0 1px var(--primary-color) inset;
            background: rgba(67, 97, 238, 0.1);
            border-radius: 10px;
            z-index: 5;
        }

        .dark-mode .voice-info-bar {
            background: rgba(67, 97, 238, 0.2);
        }

        .voice-info-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .voice-info-right {
            display: flex;
            gap: 10px;
        }

        .voice-setting {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 20px;
            padding: 6px 14px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 6px;
            color: var(--dark-color);
        }

        .voice-setting:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .setting-icon {
            font-size: 0.9rem;
        }

        .chat-history {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            background-color: var(--light-color);
            background-image:
                linear-gradient(rgba(0, 0, 0, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 0, 0, 0.03) 1px, transparent 1px);
            background-size: 20px 20px;
        }

        .dark-mode .chat-history {
            background-image:
                linear-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
        }

        .message {
            max-width: 85%;
            padding: 16px;
            margin-bottom: 16px;
            border-radius: var(--border-radius);
            position: relative;
            animation: fadeIn 0.3s ease;
            box-shadow: var(--card-shadow);
            line-height: 1.5;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .user-message {
            align-self: flex-end;
            background-color: var(--user-message-bg);
            color: white;
            border-bottom-right-radius: 4px;
        }

        .system-message,
        .system-merged-message {
            align-self: flex-start;
            background-color: var(--system-message-bg);
            color: var(--text-color);
            border-bottom-left-radius: 4px;
        }

        .message-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.85rem;
            opacity: 0.9;
        }

        .user-message .message-header {
            color: rgba(255, 255, 255, 0.9);
        }

        .system-message .message-header {
            color: var(--gray-color);
        }

        .message-text {
            margin-bottom: 10px;
            word-break: break-word;
        }

        .message-audio {
            display: flex;
            align-items: center;
            margin-top: 12px;
        }

        .audio-player {
            display: flex;
            align-items: center;
            gap: 12px;
            width: 100%;
            min-width: 200px;
        }

        .play-button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
            flex-shrink: 0;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .user-message .play-button {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .user-message .play-button:hover {
            background-color: rgba(255, 255, 255, 0.3);
        }

        .system-message .play-button:hover {
            background-color: var(--primary-light);
        }

        .audio-progress {
            flex: 1;
            height: 6px;
            background-color: rgba(0, 0, 0, 0.1);
            border-radius: 3px;
            overflow: hidden;
            cursor: pointer;
        }

        .dark-mode .audio-progress {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .user-message .audio-progress {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .audio-progress-filled {
            height: 100%;
            background-color: var(--primary-color);
            width: 0%;
            transition: width 0.1s linear;
        }

        .user-message .audio-progress-filled {
            background-color: white;
        }

        .audio-time {
            font-size: 0.8rem;
            min-width: 40px;
            text-align: center;
            font-feature-settings: "tnum";
            font-variant-numeric: tabular-nums;
        }

        .user-message .audio-time {
            color: rgba(255, 255, 255, 0.9);
        }

        .system-message .audio-time {
            color: var(--gray-color);
        }

        .download-button {
            background: none;
            border: 1px solid var(--border-color);
            border-radius: 50%;
            width: 36px;
            height: 36px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
            margin-left: 8px;
            flex-shrink: 0;
            color: inherit;
            font-size: 1rem;
        }

        .system-message .download-button {
            color: var(--gray-color);
            border-color: var(--border-color);
        }

        .system-message .download-button:hover {
            background-color: rgba(67, 97, 238, 0.1);
            color: var(--primary-color);
            border-color: var(--primary-color);
        }

        .dark-mode .system-message .download-button:hover {
            background-color: rgba(67, 97, 238, 0.2);
        }

        /* ÂêàÂπ∂Èü≥È¢ëÊåâÈíÆÂå∫Âüü */
        .merge-audio-panel {
            position: fixed;
            bottom: 90px;
            right: 20px;
            background-color: var(--header-bg);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            padding: 12px 16px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            display: none;
            align-items: center;
            gap: 12px;
            z-index: 100;
            animation: slideUp 0.2s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .merge-audio-panel.active {
            display: flex;
        }

        .merge-audio-count {
            font-size: 0.9rem;
            color: var(--dark-color);
            font-weight: 500;
        }

        .merge-audio-button {
            background: var(--secondary-color);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            padding: 8px 16px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .merge-audio-button:hover:not(:disabled) {
            background: #5e0a98;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .merge-audio-button:disabled {
            background-color: var(--gray-color);
            cursor: not-allowed;
        }

        .input-area {
            padding: 16px;
            background-color: var(--input-bg);
            border-top: 1px solid var(--border-color);
            display: flex;
            gap: 12px;
            align-items: flex-end;
            position: relative;
            z-index: 5;
        }

        .text-input {
            flex: 1;
            padding: 12px 16px;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            outline: none;
            font-size: 1rem;
            transition: var(--transition);
            resize: none;
            min-height: 48px;
            max-height: 150px;
            font-family: inherit;
            background-color: var(--input-bg);
            color: var(--text-color);
            box-shadow: var(--card-shadow);
        }

        .text-input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        }

        .send-button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            width: 48px;
            height: 48px;
            cursor: pointer;
            font-weight: 500;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .send-button:hover:not(:disabled) {
            background-color: var(--primary-dark);
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .send-button:disabled {
            background-color: var(--gray-color);
            cursor: not-allowed;
            opacity: 0.7;
        }

        .send-icon {
            font-size: 1.2rem;
        }

        .status {
            padding: 12px 16px;
            text-align: center;
            color: var(--gray-color);
            font-size: 0.85rem;
            border-top: 1px solid var(--border-color);
            transition: var(--transition);
            background-color: var(--input-bg);
        }

        .status.error {
            background-color: rgba(230, 57, 70, 0.1);
            color: var(--danger-color);
        }

        .dark-mode .status.error {
            background-color: rgba(230, 57, 70, 0.2);
        }

        .status.success {
            background-color: rgba(76, 201, 240, 0.1);
            color: var(--success-color);
        }

        .dark-mode .status.success {
            background-color: rgba(76, 201, 240, 0.2);
        }

        /* Èü≥Ëâ≤ËÆæÁΩÆÊ®°ÊÄÅÊ°Ü */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(3px);
        }

        .modal-content {
            background-color: var(--sidebar-bg);
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            animation: modalOpen 0.3s ease;
            overflow: hidden;
        }

        @keyframes modalOpen {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: var(--header-bg);
        }

        .modal-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--dark-color);
        }

        .close-button {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray-color);
            transition: var(--transition);
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .close-button:hover {
            background-color: rgba(0, 0, 0, 0.05);
            color: var(--dark-color);
        }

        .dark-mode .close-button:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .modal-body {
            padding: 20px;
        }

        .form-group {
            margin-bottom: 24px;
        }

        .form-label {
            display: block;
            margin-bottom: 10px;
            font-weight: 500;
            color: var(--dark-color);
            font-size: 0.95rem;
        }

        .slider-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .slider {
            flex: 1;
            height: 6px;
            border-radius: 3px;
            background: var(--border-color);
            outline: none;
            -webkit-appearance: none;
            transition: var(--transition);
        }

        .slider:focus {
            background: var(--gray-color);
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--primary-color);
            cursor: pointer;
            transition: var(--transition);
            border: 2px solid white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .slider::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--primary-color);
            cursor: pointer;
            border: none;
        }

        .slider-value {
            min-width: 40px;
            text-align: center;
            font-weight: 500;
            font-size: 0.9rem;
        }

        .slider-labels {
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            color: var(--gray-color);
            margin-top: 8px;
        }

        .modal-footer {
            padding: 16px 20px;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            background-color: var(--input-bg);
        }

        .btn {
            padding: 8px 16px;
            border-radius: var(--border-radius);
            font-size: 0.9rem;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
            min-width: 80px;
            text-align: center;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
            border: 1px solid var(--primary-color);
        }

        .btn-primary:hover {
            background-color: var(--primary-dark);
            border-color: var(--primary-dark);
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .btn-secondary {
            background-color: var(--input-bg);
            color: var(--dark-color);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            background-color: var(--system-message-bg);
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        /* Ê¨¢ËøéÊ∂àÊÅØ */
        .welcome-message {
            text-align: center;
            color: var(--gray-color);
            margin-top: 50px;
            animation: fadeIn 0.5s ease;
        }

        .welcome-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            color: var(--primary-color);
            opacity: 0.8;
        }

        .welcome-title {
            margin-bottom: 12px;
            color: var(--dark-color);
            font-size: 1.5rem;
            font-weight: 600;
        }

        .welcome-subtitle {
            margin-bottom: 24px;
            font-size: 1rem;
        }

        /* Â§çÈÄâÊ°ÜÊ†∑Âºè */
        .audio-select-checkbox {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border: 2px solid var(--border-color);
            border-radius: 4px;
            margin-right: 12px;
            cursor: pointer;
            position: relative;
            flex-shrink: 0;
            align-self: center;
            transition: var(--transition);
        }

        .audio-select-checkbox:checked {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }

        .audio-select-checkbox:checked::after {
            content: "‚úì";
            position: absolute;
            color: white;
            font-size: 12px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        /* ÂìçÂ∫îÂºèËÆæËÆ° */
        @media (max-width: 768px) {
            .voice-panel {
                width: 240px;
            }

            .message {
                max-width: 90%;
            }
        }

        @media (max-width: 480px) {
            .voice-panel {
                width: 100%;
                position: absolute;
                height: 100%;
                z-index: 20;
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }

            .voice-panel.active {
                transform: translateX(0);
            }

            .message {
                max-width: 95%;
                padding: 12px;
            }

            .modal-content {
                width: 95%;
            }

            .merge-audio-panel {
                bottom: 80px;
                right: 10px;
            }
        }

        /* Â∑•ÂÖ∑ÊèêÁ§∫ */
        .tooltip {
            position: relative;
        }

        .tooltip:hover::after {

            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background-color: #333;
            color: white;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 0.8rem;
            white-space: nowrap;
            z-index: 100;
            pointer-events: none;
            margin-bottom: 8px;
            display: none;
        }

        .dark-mode .tooltip:hover::after {
            background-color: #555;
        }
    </style>
</head>

<body>
    <div class="container">
        <!-- Â∑¶‰æßÈü≥Ëâ≤ÂàóË°® -->
        <div class="voice-panel" id="voicePanel">
            <div class="header">
                <h1>
                    <span class="logo">
                        <span class="logo-icon">üîä</span>
                        <span>VT - TTS</span>
                    </span>
                </h1>
                <div class="header-actions">
                    <button class="theme-toggle tooltip" id="themeToggle" data-tooltip="ÂàáÊç¢‰∏ªÈ¢ò">
                        <span>üåô</span>
                    </button>
                    <button id="toggleVoicePanel" class="tooltip" data-tooltip="ÂàáÊç¢Èù¢Êùø"
                        style="background:none; border:none; font-size:1.2rem; cursor:pointer; display:none; width:36px; height:36px; display:none; align-items:center; justify-content:center; border-radius:50%;">‚ò∞</button>
                </div>
            </div>
            <div class="panel-header" style="display: none;">
                <span>Èü≥Ëâ≤ÂàóË°®</span>
                <span id="voiceCount">0 ‰∏™Èü≥Ëâ≤</span>
            </div>
            <div class="voice-search">
                <input type="text" class="search-input" id="voiceSearch" placeholder="ÊêúÁ¥¢Èü≥Ëâ≤...">
            </div>
            <div class="voice-list" id="voiceList">
                <!-- Èü≥Ëâ≤ÂàóË°®È°πÂ∞ÜÈÄöËøáJavaScriptÂä®ÊÄÅÁîüÊàê -->
            </div>
        </div>

        <!-- Âè≥‰æßËÅäÂ§©Âå∫Âüü -->
        <div class="chat-panel">
            <!-- ÂΩìÂâçÈü≥Ëâ≤‰ø°ÊÅØÂ±ïÁ§∫Êù° -->
            <div class="voice-info-bar" id="voiceInfoBar">
                <div class="voice-info-left">
                    <span id="currentVoiceName">Êú™ÈÄâÊã©Èü≥Ëâ≤</span>
                    <span id="currentVoiceDetails"></span>
                </div>
                <div class="voice-info-right">
                    <button class="voice-setting tooltip" id="voiceSettings" data-tooltip="Èü≥Ëâ≤ËÆæÁΩÆ">
                        <span class="setting-icon">‚öôÔ∏è</span>
                        <span>ËÆæÁΩÆ</span>
                    </button>
                </div>
            </div>

            <!-- ÂêàÂπ∂Èü≥È¢ëÊåâÈíÆÂå∫Âüü -->
            <div class="merge-audio-panel" id="mergeAudioPanel">
                <span class="merge-audio-count">Â∑≤ÈÄâÊã© <span id="selectedAudioCount">0</span> ‰∏™Èü≥È¢ë</span>
                <button class="merge-audio-button tooltip" id="mergeAudioButton" disabled
                    data-tooltip="ÂêàÂπ∂ÈÄâ‰∏≠ÁöÑÈü≥È¢ëÊñá‰ª∂">ÂêàÂπ∂Èü≥È¢ë</button>
            </div>

            <div class="chat-history" id="chatHistory">
                <!-- ËÅäÂ§©ËÆ∞ÂΩïÂ∞ÜÈÄöËøáJavaScriptÂä®ÊÄÅÁîüÊàê -->
                <div class="welcome-message">
                    <div class="welcome-icon">üîä</div>
                    <h2 class="welcome-title">Ê¨¢Ëøé‰ΩøÁî® VT ÊñáÂ≠óËΩ¨ËØ≠Èü≥Â∑•ÂÖ∑</h2>
                    <p class="welcome-subtitle">ËØ∑‰ªéÂ∑¶‰æßÈÄâÊã©‰∏Ä‰∏™Èü≥Ëâ≤ÂºÄÂßãËΩ¨Êç¢ÊñáÂ≠ó‰∏∫ËØ≠Èü≥</p>
                </div>
            </div>

            <div class="status" id="status">Â∞±Áª™</div>

            <div class="input-area">
                <textarea class="text-input" id="textInput" placeholder="ËØ∑ËæìÂÖ•Ë¶ÅËΩ¨Êç¢ÁöÑÊñáÂ≠ó..." disabled rows="1"></textarea>
                <button class="send-button tooltip" id="sendButton" disabled data-tooltip="ÂèëÈÄÅÊñáÂ≠óËΩ¨ËØ≠Èü≥">
                    <span class="send-icon">‚Üë</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Èü≥Ëâ≤ËÆæÁΩÆÊ®°ÊÄÅÊ°Ü -->
    <div class="modal" id="settingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Èü≥Ëâ≤ËÆæÁΩÆ</div>
                <button class="close-button">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Èü≥Ë∞É</label>
                    <div class="slider-container">
                        <input type="range" min="-100" max="100" value="0" class="slider" id="pitchSlider">
                        <span class="slider-value" id="pitchValue">0</span>
                    </div>
                    <div class="slider-labels">
                        <span>‰ΩéÈü≥Ë∞É</span>
                        <span>È´òÈü≥Ë∞É</span>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">ËØ≠ÈÄü</label>
                    <div class="slider-container">
                        <input type="range" min="-100" max="200" value="10" class="slider" id="rateSlider">
                        <span class="slider-value" id="rateValue">1.0</span>
                    </div>
                    <div class="slider-labels">
                        <span>ÊÖ¢ÈÄü</span>
                        <span>Âø´ÈÄü</span>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Èü≥Èáè</label>
                    <div class="slider-container">
                        <input type="range" min="0" max="100" value="50" class="slider" id="volumeSlider">
                        <span class="slider-value" id="volumeValue">50%</span>
                    </div>
                    <div class="slider-labels">
                        <span>Â∞èÂ£∞</span>
                        <span>Â§ßÂ£∞</span>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelSettings">ÂèñÊ∂à</button>
                <button class="btn btn-primary" id="saveSettings">‰øùÂ≠òËÆæÁΩÆ</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // DOMÂÖÉÁ¥†
            const voiceListElement = document.getElementById('voiceList');
            const chatHistoryElement = document.getElementById('chatHistory');
            const textInputElement = document.getElementById('textInput');
            const sendButtonElement = document.getElementById('sendButton');
            const statusElement = document.getElementById('status');
            const voiceInfoBar = document.getElementById('voiceInfoBar');
            const currentVoiceName = document.getElementById('currentVoiceName');
            const currentVoiceDetails = document.getElementById('currentVoiceDetails');
            const voiceSearch = document.getElementById('voiceSearch');
            const voiceCount = document.getElementById('voiceCount');
            const toggleVoicePanel = document.getElementById('toggleVoicePanel');
            const voicePanel = document.getElementById('voicePanel');
            const mergeAudioPanel = document.getElementById('mergeAudioPanel');
            const mergeAudioButton = document.getElementById('mergeAudioButton');
            const selectedAudioCount = document.getElementById('selectedAudioCount');

            // Êï∞ÊçÆÁä∂ÊÄÅ
            let selectedVoice = null;
            let audioPlayers = new Map(); // Â≠òÂÇ®Èü≥È¢ëÊí≠ÊîæÂô®ÂÆû‰æã
            let allVoices = []; // Â≠òÂÇ®ÊâÄÊúâÈü≥Ëâ≤
            let currentVoiceSettings = {
                pitch: 0,
                rate: 10, // 10 ÂØπÂ∫î 1.0
                volume: 50 // 50 ÂØπÂ∫î 50%
            };
            let selectedAudioMessages = new Map(); // Â≠òÂÇ®ÈÄâ‰∏≠ÁöÑÈü≥È¢ëÊ∂àÊÅØÔºå‰ΩøÁî®MapÊõø‰ª£Set

            // Èü≥Ëâ≤ËÆæÁΩÆÁõ∏ÂÖ≥ÂÖÉÁ¥†
            const voiceSettingsBtn = document.getElementById('voiceSettings');
            const settingsModal = document.getElementById('settingsModal');
            const closeModalBtn = document.querySelector('.close-button');
            const cancelSettingsBtn = document.getElementById('cancelSettings');
            const saveSettingsBtn = document.getElementById('saveSettings');
            const pitchSlider = document.getElementById('pitchSlider');
            const rateSlider = document.getElementById('rateSlider');
            const volumeSlider = document.getElementById('volumeSlider');
            const pitchValue = document.getElementById('pitchValue');
            const rateValue = document.getElementById('rateValue');
            const volumeValue = document.getElementById('volumeValue');
            const themeToggle = document.getElementById('themeToggle');
            const body = document.body;

            // Ê£ÄÊü•Êú¨Âú∞Â≠òÂÇ®‰∏≠ÁöÑ‰∏ªÈ¢òËÆæÁΩÆ
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                body.classList.add('dark-mode');
                themeToggle.innerHTML = '‚òÄÔ∏è';
                themeToggle.setAttribute('data-tooltip', 'ÂàáÊç¢Êòé‰∫ÆÊ®°Âºè');
            } else {
                themeToggle.innerHTML = 'üåô';
                themeToggle.setAttribute('data-tooltip', 'ÂàáÊç¢ÊöóÈªëÊ®°Âºè');
            }

            // ÂàùÂßãÂåñ
            initVoices();
            initEventListeners();

            // ÂàùÂßãÂåñÈü≥Ëâ≤ÂàóË°®
            async function initVoices() {
                try {
                    updateStatus('Ê≠£Âú®Âä†ËΩΩÈü≥Ëâ≤ÂàóË°®...');

                    // ÊòæÁ§∫Âä†ËΩΩÊåáÁ§∫
                    const loadingIndicator = document.createElement('div');
                    loadingIndicator.className = 'loading-indicator';
                    loadingIndicator.style.cssText = `
                        position: absolute;
                        top: 50%;
                        left: 50%;
                        transform: translate(-50%, -50%);
                        font-size: 1.2rem;
                        color: var(--gray-color);
                        display: flex;
                        align-items: center;
                        gap: 10px;
                    `;
                    loadingIndicator.innerHTML = 'üîÑ Ê≠£Âú®Âä†ËΩΩÈü≥Ëâ≤ÂàóË°®...';
                    voiceListElement.appendChild(loadingIndicator);

                    // ‰ªé‰∏ªËøõÁ®ãËé∑ÂèñÈü≥Ëâ≤ÂàóË°®
                    allVoices = await window.electronAPI.getVoices();
                    console.log('Ëé∑ÂèñÈü≥Ëâ≤ÂàóË°®ÊàêÂäü:', allVoices);
                    // È™åËØÅËøîÂõûÊï∞ÊçÆÊ†ºÂºè
                    if (!Array.isArray(allVoices)) {
                        throw new Error('Êó†ÊïàÁöÑÈü≥Ëâ≤ÂàóË°®Ê†ºÂºèÔºöÊï∞ÊçÆ‰∏çÊòØÊï∞ÁªÑ');
                    }

                    // ËøáÊª§Êó†ÊïàÈü≥Ëâ≤
                    allVoices = allVoices.filter(voice => {
                        if (!voice || typeof voice !== 'object') {
                            console.warn('ÂèëÁé∞Êó†ÊïàÁöÑÈü≥Ëâ≤ÂØπË±°');
                            return false;
                        }

                        // Á°Æ‰øùÂøÖË¶ÅÂ≠óÊÆµÂ≠òÂú®
                        if (!voice.id || !voice.name || !voice.language) {
                            console.warn('Èü≥Ëâ≤Áº∫Â∞ëÂøÖË¶ÅÂ≠óÊÆµ:', voice);
                            return false;
                        }

                        return true;
                    });

                    // ÊéíÂ∫èÈü≥Ëâ≤ÂàóË°®ÔºàÊåâËØ≠Ë®ÄÂàÜÁªÑÔºåÂÜçÊåâÂêçÁß∞ÊéíÂ∫èÔºâ
                    // allVoices.sort((a, b) => {
                    //     // È¶ñÂÖàÊåâËØ≠Ë®ÄÊéíÂ∫èÔºà‰∏≠ÊñáÂú®ÂâçÔºâ
                    //     if (a.language.includes('‰∏≠Êñá') && !b.language.includes('‰∏≠Êñá')) return -1;
                    //     if (!a.language.includes('‰∏≠Êñá') && b.language.includes('‰∏≠Êñá')) return 1;

                    //     // ÁÑ∂ÂêéÊåâÂêçÁß∞ÊéíÂ∫è
                    //     return a.name.localeCompare(b.name);
                    // });

                    // Ê∏≤ÊüìÈü≥Ëâ≤ÂàóË°®
                    renderVoiceList(allVoices);

                    // Êõ¥Êñ∞Èü≥Ëâ≤ËÆ°Êï∞
                    voiceCount.textContent = `${allVoices.length} ‰∏™Èü≥Ëâ≤`;

                    // Â¶ÇÊûúÊúâÈü≥Ëâ≤ÔºåÈÄâÊã©Á¨¨‰∏Ä‰∏™
                    if (allVoices.length > 0) {
                        selectVoice(allVoices[0]);
                    } else {
                        // ÊòæÁ§∫Êó†Èü≥Ëâ≤Ê∂àÊÅØ
                        const emptyMessage = document.createElement('div');
                        emptyMessage.className = 'empty-message';
                        emptyMessage.style.cssText = `
                            text-align: center;
                            padding: 20px;
                            color: var(--gray-color);
                            font-size: 0.95rem;
                        `;
                        emptyMessage.textContent = 'Êú™ÊâæÂà∞ÂèØÁî®Èü≥Ëâ≤„ÄÇËØ∑Á°Æ‰øùËØ≠Èü≥ÊúçÂä°Â∑≤Ê≠£Á°ÆÂÆâË£Ö„ÄÇ';
                        voiceListElement.appendChild(emptyMessage);
                    }

                    // ÁßªÈô§Âä†ËΩΩÊåáÁ§∫
                    setTimeout(() => {
                        const loader = document.querySelector('.loading-indicator');
                        if (loader) loader.remove();
                    }, 300);

                    // Êõ¥Êñ∞Áä∂ÊÄÅÊ†è
                    updateStatus('Èü≥Ëâ≤ÂàóË°®Âä†ËΩΩÂÆåÊàê', 'success');
                } catch (error) {
                    console.error('Âä†ËΩΩÈü≥Ëâ≤ÂàóË°®Â§±Ë¥•:', error);

                    // ÁßªÈô§Âä†ËΩΩÊåáÁ§∫
                    const loader = document.querySelector('.loading-indicator');
                    if (loader) loader.remove();

                    // ÊòæÁ§∫Á©∫Èü≥Ëâ≤ÂàóË°®Ê∂àÊÅØ
                    voiceListElement.innerHTML = `
                        <div style="text-align:center;padding:20px;color:var(--danger-color);">
                            <div style="font-size:1.5rem;margin-bottom:10px;">‚ùå</div>
                            <div>Êó†Ê≥ïÂä†ËΩΩÈü≥Ëâ≤ÂàóË°®</div>
                            <div style="font-size:0.9rem;margin-top:8px;color:var(--gray-color);">${error.message}</div>
                        </div>
                    `;

                    // Êõ¥Êñ∞Áä∂ÊÄÅÊ†è
                    updateStatus('Âä†ËΩΩÈü≥Ëâ≤ÂàóË°®Â§±Ë¥•: ' + error.message, 'error');
                }
            }

            // Ê∏≤ÊüìÈü≥Ëâ≤ÂàóË°®
            function renderVoiceList(voices) {
                voiceListElement.innerHTML = '';

                if (voices.length === 0) {
                    voiceListElement.innerHTML = '<div style="text-align:center;padding:20px;color:var(--gray-color);">Êú™ÊâæÂà∞ÂåπÈÖçÁöÑÈü≥Ëâ≤</div>';
                    return;
                }

                voices.forEach(voice => {
                    const voiceItem = document.createElement('div');
                    voiceItem.className = 'voice-item';
                    voiceItem.dataset.id = voice.id;

                    voiceItem.innerHTML = `
                        <div class="voice-item-header">
                            <div class="voice-name">${voice.name}</div>
                            <div class="voice-tag">${voice.language.includes('‰∏≠Êñá') ? '‰∏≠' : 'Ëã±'}</div>
                        </div>
                        <div class="voice-lang">${voice.language}</div>
                        <div class="voice-details">
                            <div class="voice-detail-item"><i>üéµ</i> Èü≥Ë∞É: ${voice.pitch >= 0 ? '+' : ''}${voice.pitch}</div>
                            <div class="voice-detail-item"><i>‚è±Ô∏è</i> ËØ≠ÈÄü: ${parseInt(voice.rate) >= 0 ? '+' : ''}${voice.rate}</div>
                            <div class="voice-detail-item"><i>üîä</i> Èü≥Èáè: ${voice.volume}</div>
                        </div>
                    `;

                    voiceItem.addEventListener('click', () => {
                        // ËÆæÁΩÆÈÄâ‰∏≠Áä∂ÊÄÅ
                        document.querySelectorAll('.voice-item').forEach(item => {
                            item.classList.remove('active');
                        });
                        voiceItem.classList.add('active');

                        // Êõ¥Êñ∞ÈÄâ‰∏≠Èü≥Ëâ≤
                        selectedVoice = voice;

                        // ÂêØÁî®ÊñáÊú¨ËæìÂÖ•ÂíåÂèëÈÄÅÊåâÈíÆ
                        textInputElement.disabled = false;
                        sendButtonElement.disabled = false;
                        textInputElement.placeholder = `‰ΩøÁî®"${voice.name}"Èü≥Ëâ≤ËæìÂÖ•ÊñáÂ≠ó...`;
                        textInputElement.focus();

                        // ÊòæÁ§∫Èü≥Ëâ≤ËØ¶ÁªÜ‰ø°ÊÅØ
                        showVoiceInfo(voice);

                        // Âú®ÁßªÂä®ËÆæÂ§á‰∏äÈöêËóèÈü≥Ëâ≤Èù¢Êùø
                        if (window.innerWidth <= 480) {
                            voicePanel.classList.remove('active');
                        }

                        updateStatus(`Â∑≤ÈÄâÊã©Èü≥Ëâ≤: ${voice.name}`, 'success');
                    });

                    voiceListElement.appendChild(voiceItem);
                });
            }

            // ÈÄâ‰∏≠ÊåáÂÆöÈü≥Ëâ≤
            function selectVoice(voice) {
                // ËÆæÁΩÆÈÄâ‰∏≠Áä∂ÊÄÅ
                document.querySelectorAll('.voice-item').forEach(item => {
                    item.classList.remove('active');
                });

                const voiceItem = document.querySelector(`.voice-item[data-id="${voice.id}"]`);
                if (voiceItem) {
                    voiceItem.classList.add('active');
                }

                // Êõ¥Êñ∞ÈÄâ‰∏≠Èü≥Ëâ≤
                selectedVoice = voice;

                // ÂêØÁî®ÊñáÊú¨ËæìÂÖ•ÂíåÂèëÈÄÅÊåâÈíÆ
                textInputElement.disabled = false;
                sendButtonElement.disabled = false;
                textInputElement.placeholder = `‰ΩøÁî®"${voice.name}"Èü≥Ëâ≤ËæìÂÖ•ÊñáÂ≠ó...`;

                // ÊòæÁ§∫Èü≥Ëâ≤ËØ¶ÁªÜ‰ø°ÊÅØ
                showVoiceInfo(voice);

                updateStatus(`Â∑≤ÈÄâÊã©Èü≥Ëâ≤: ${voice.name}`, 'success');
            }

            // ÊòæÁ§∫ÂΩìÂâçÈü≥Ëâ≤‰ø°ÊÅØ
            function showVoiceInfo(voice) {
                if (!voice) {
                    currentVoiceName.textContent = 'Êú™ÈÄâÊã©Èü≥Ëâ≤';
                    currentVoiceDetails.textContent = '';
                    voiceInfoBar.style.display = 'flex';
                    return;
                }

                currentVoiceName.textContent = voice.name;
                currentVoiceDetails.innerHTML = `
                    ${voice.language} ‚Ä¢ Èü≥Ë∞É: ${voice.pitch >= 0 ? '+' : ''}${voice.pitch} ‚Ä¢ 
                    ËØ≠ÈÄü: ${parseInt(voice.rate) >= 0 ? '+' : ''}${voice.rate} ‚Ä¢ Èü≥Èáè: ${voice.volume}
                `;
                voiceInfoBar.style.display = 'flex';
            }

            // ÂàùÂßãÂåñ‰∫ã‰ª∂ÁõëÂê¨Âô®
            function initEventListeners() {
                // ÂèëÈÄÅÊåâÈíÆÁÇπÂáª‰∫ã‰ª∂
                sendButtonElement.addEventListener('click', sendMessage);

                // Â§öË°åËæìÂÖ•ÊîØÊåÅ
                textInputElement.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter') {
                        if (e.ctrlKey || e.metaKey || e.shiftKey) {
                            // Êç¢Ë°åÔºàtextareaÈªòËÆ§Ë°å‰∏∫Ôºâ
                            return;
                        } else {
                            // ÊôÆÈÄöEnterÂèëÈÄÅ
                            e.preventDefault();
                            sendMessage();
                        }
                    }
                });

                // Ëá™Âä®Ë∞ÉÊï¥textareaÈ´òÂ∫¶
                textInputElement.addEventListener('input', () => {
                    textInputElement.style.height = 'auto';
                    textInputElement.style.height = Math.min(textInputElement.scrollHeight, 150) + 'px';
                });

                // Èü≥Ëâ≤ÊêúÁ¥¢
                voiceSearch.addEventListener('input', (e) => {
                    const keyword = e.target.value.toLowerCase();
                    const filteredVoices = allVoices.filter(voice =>
                        voice.name.toLowerCase().includes(keyword) ||
                        voice.language.toLowerCase().includes(keyword)
                    );
                    renderVoiceList(filteredVoices);
                });

                // ÂàáÊç¢Èü≥Ëâ≤Èù¢ÊùøÔºàÁßªÂä®Á´ØÔºâ
                toggleVoicePanel.addEventListener('click', () => {
                    voicePanel.classList.toggle('active');
                });

                // Á™óÂè£Â§ßÂ∞èÊîπÂèòÊó∂ÁöÑÂ§ÑÁêÜ
                window.addEventListener('resize', () => {
                    if (window.innerWidth > 480) {
                        voicePanel.classList.remove('active');
                        toggleVoicePanel.style.display = 'none';
                    } else {
                        toggleVoicePanel.style.display = 'flex';
                    }
                });

                // ÂàùÂßãÂåñÁßªÂä®Á´ØÊåâÈíÆÊòæÁ§∫
                if (window.innerWidth <= 480) {
                    toggleVoicePanel.style.display = 'flex';
                }

                // Èü≥Ëâ≤ËÆæÁΩÆÊåâÈíÆ‰∫ã‰ª∂
                voiceSettingsBtn.addEventListener('click', () => {
                    if (!selectedVoice) {
                        updateStatus('ËØ∑ÂÖàÈÄâÊã©‰∏Ä‰∏™Èü≥Ëâ≤', 'error');
                        return;
                    }
                    // ËÆæÁΩÆÊªëÂùóÁöÑÂΩìÂâçÂÄº
                    pitchSlider.value = parseParamValue(selectedVoice.pitch) || 0;
                    rateSlider.value = parseParamValue(selectedVoice.rate) || 10;
                    volumeSlider.value = parseParamValue(selectedVoice.volume) || 50;
                    console.log(selectedVoice);
                    // Êõ¥Êñ∞ÊòæÁ§∫ÂÄº
                    updateSliderValues();

                    // ÊòæÁ§∫Ê®°ÊÄÅÊ°Ü
                    settingsModal.style.display = 'flex';
                });

                // ÂÖ≥Èó≠Ê®°ÊÄÅÊ°Ü‰∫ã‰ª∂
                closeModalBtn.addEventListener('click', closeSettingsModal);
                cancelSettingsBtn.addEventListener('click', closeSettingsModal);

                // ÁÇπÂáªÊ®°ÊÄÅÊ°ÜÂ§ñÈÉ®ÂÖ≥Èó≠
                window.addEventListener('click', (e) => {
                    if (e.target === settingsModal) {
                        closeSettingsModal();
                    }
                });

                // ÊªëÂùóÂÄºÂèòÂåñ‰∫ã‰ª∂
                pitchSlider.addEventListener('input', updateSliderValues);
                rateSlider.addEventListener('input', updateSliderValues);
                volumeSlider.addEventListener('input', updateSliderValues);

                // ‰øùÂ≠òËÆæÁΩÆ‰∫ã‰ª∂
                saveSettingsBtn.addEventListener('click', saveVoiceSettings);

                // ‰∏ªÈ¢òÂàáÊç¢‰∫ã‰ª∂
                themeToggle.addEventListener('click', toggleTheme);

                // Ê∑ªÂä†ËÅäÂ§©Âå∫ÂüüÁÇπÂáª‰∫ã‰ª∂ÔºåÁî®‰∫éÂèñÊ∂àÈü≥È¢ëÈÄâÊã©
                chatHistoryElement.addEventListener('click', (e) => {
                    // Â¶ÇÊûúÁÇπÂáªÁöÑ‰∏çÊòØÈü≥È¢ëÈÄâÊã©Â§çÈÄâÊ°ÜÔºåÂàôÂèñÊ∂àÊâÄÊúâÈÄâÊã©
                    if (!e.target.classList.contains('audio-select-checkbox')) {
                        clearAudioSelection();
                    }
                });

                // ÂêàÂπ∂Èü≥È¢ëÊåâÈíÆ‰∫ã‰ª∂
                mergeAudioButton.addEventListener('click', mergeSelectedAudio);

                // ÁõëÂê¨‰∏ªËøõÁ®ãÁä∂ÊÄÅÊõ¥Êñ∞
                window.electronAPI.onUpdateStatus((message) => {
                    updateStatus(message, 'info');
                });
            }

            // ÂàáÊç¢‰∏ªÈ¢òÊ®°Âºè
            function toggleTheme() {
                body.classList.toggle('dark-mode');

                // Êõ¥Êñ∞ÊåâÈíÆÂõæÊ†áÂíåÊèêÁ§∫‰ø°ÊÅØ
                if (body.classList.contains('dark-mode')) {
                    themeToggle.innerHTML = '‚òÄÔ∏è';
                    themeToggle.setAttribute('data-tooltip', 'ÂàáÊç¢Êòé‰∫ÆÊ®°Âºè');
                    localStorage.setItem('theme', 'dark');
                } else {
                    themeToggle.innerHTML = 'üåô';
                    themeToggle.setAttribute('data-tooltip', 'ÂàáÊç¢ÊöóÈªëÊ®°Âºè');
                    localStorage.setItem('theme', 'light');
                }
            }

            // Êõ¥Êñ∞ÊªëÂùóÂÄºÊòæÁ§∫
            function updateSliderValues() {
                pitchValue.textContent = pitchSlider.value >= 0 ? `+${pitchSlider.value}%` : `${pitchSlider.value}%`;
                rateValue.textContent = rateSlider.value >= 0 ? `+${rateSlider.value}%` : `${rateSlider.value}%`;
                // rateValue.textContent = (rateSlider.value / 10).toFixed(1);
                volumeValue.textContent = `${volumeSlider.value}%`;
            }

            // Ëß£ÊûêÂèÇÊï∞ÂÄº
            function parseParamValue(value) {
                if (typeof value === 'string') {
                    // ÁßªÈô§ÁôæÂàÜÂè∑Âπ∂ËΩ¨Êç¢‰∏∫Êï¥Êï∞
                    if (value.endsWith('%')) {
                        return parseInt(value);
                    }
                    // Â§ÑÁêÜÂ∏¶Á¨¶Âè∑ÁöÑÊï∞ÂÄº
                    return parseInt(value) || 0;
                }
                return parseInt(value) || 0;
            }

            // ÂÖ≥Èó≠ËÆæÁΩÆÊ®°ÊÄÅÊ°Ü
            function closeSettingsModal() {
                settingsModal.style.display = 'none';
            }

            // ‰øùÂ≠òÈü≥Ëâ≤ËÆæÁΩÆ
            function saveVoiceSettings() {
                // Êõ¥Êñ∞ÈÄâ‰∏≠Èü≥Ëâ≤ÁöÑËÆæÁΩÆ
                console.log(rateSlider.value)
                selectedVoice.pitch = `${parseInt(pitchSlider.value)}%`;
                selectedVoice.rate = `${parseInt(rateSlider.value)}%`;
                selectedVoice.volume = `${parseInt(volumeSlider.value)}%`;
                // Êõ¥Êñ∞Èü≥Ëâ≤‰ø°ÊÅØÊòæÁ§∫
                showVoiceInfo(selectedVoice);

                // ÂÖ≥Èó≠Ê®°ÊÄÅÊ°Ü
                closeSettingsModal();

                updateStatus(`Â∑≤‰øùÂ≠ò ${selectedVoice.name} ÁöÑËÆæÁΩÆ`, 'success');
            }

            // ÂèëÈÄÅÊ∂àÊÅØ
            async function sendMessage() {
                const text = textInputElement.value.trim();
                if (!text || !selectedVoice) return;

                // Ê∑ªÂä†Áî®Êà∑Ê∂àÊÅØÂà∞ËÅäÂ§©ËÆ∞ÂΩï
                addMessageToChat(text, 'user');

                // Ê∏ÖÁ©∫ËæìÂÖ•Ê°ÜÂπ∂ÈáçÁΩÆÈ´òÂ∫¶
                textInputElement.value = '';
                textInputElement.style.height = 'auto';
                console.log(selectedVoice)
                //return
                // ÊñáÂ≠óËΩ¨ËØ≠Èü≥
                await textToSpeech(text, selectedVoice);
            }

            // Ê∑ªÂä†Ê∂àÊÅØÂà∞ËÅäÂ§©ËÆ∞ÂΩï
            function addMessageToChat(text, type, audioData) {
                // ÁßªÈô§Ê¨¢ËøéÊ∂àÊÅØÔºàÂ¶ÇÊûúÂ≠òÂú®Ôºâ
                const welcomeMessage = document.querySelector('.welcome-message');
                if (welcomeMessage) {
                    welcomeMessage.remove();
                }

                const messageElement = document.createElement('div');
                messageElement.className = `message ${type}-message`;

                // Ëé∑ÂèñÂΩìÂâçÊó∂Èó¥
                const now = new Date();
                const timeString = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;

                if (type === 'user') {
                    text = text.replace(/\n/g, '<br>');
                    messageElement.innerHTML = `
                        <div class="message-header">
                            <span>Êàë</span>
                            <span>${timeString}</span>
                        </div>
                        <div class="message-text">${text}</div>
                    `;
                } else {
                    // Á≥ªÁªüÂõûÂ§çÔºàËØ≠Èü≥Ôºâ
                    const messageId = 'msg-' + Date.now();
                    let voiceName = selectedVoice ? selectedVoice.name : 'ËØ≠Èü≥Âä©Êâã';
                    if (type === 'system-merged') {
                        voiceName = 'ÂêàÂπ∂ÁöÑËØ≠Èü≥';
                    }
                    messageElement.innerHTML = `
                        <div class="message-header">
                            <span>${voiceName}</span>
                            <span>${timeString}</span>
                        </div>
                        <div class="message-text" style="display:none">${text}</div>
                        <div class="message-audio">
                            <input type="checkbox" class="audio-select-checkbox" data-message-id="${messageId}" data-audio-path="${audioData?.path}">
                            <div class="audio-player" id="player-${messageId}">
                                <button class="play-button" data-playing="false" title="Êí≠Êîæ/ÊöÇÂÅú">‚ñ∂</button>
                                <div class="audio-progress" title="Êí≠ÊîæËøõÂ∫¶">
                                    <div class="audio-progress-filled" style="width: 0%"></div>
                                </div>
                                <div class="audio-time">00:00</div>
                                ${audioData ? `<button class="download-button" title="‰∏ãËΩΩËØ≠Èü≥">‚¨á</button>` : ''}
                            </div>
                        </div>
                    `;

                    // Â¶ÇÊûúÊúâÈü≥È¢ëÊï∞ÊçÆÔºåÊ∑ªÂä†‰∏ãËΩΩÂäüËÉΩ
                    if (audioData) {
                        setTimeout(() => {
                            const downloadBtn = messageElement.querySelector('.download-button');
                            if (downloadBtn) {
                                downloadBtn.addEventListener('click', () => {
                                    downloadAudio(audioData.path, audioData.filename);
                                });
                            }

                            // Ê∑ªÂä†Èü≥È¢ëÈÄâÊã©Â§çÈÄâÊ°Ü‰∫ã‰ª∂ÁõëÂê¨Âô®
                            const checkbox = messageElement.querySelector('.audio-select-checkbox');
                            checkbox.addEventListener('change', (e) => {
                                const messageId = e.target.dataset.messageId;
                                const audioPath = e.target.dataset.audioPath;

                                if (e.target.checked) {
                                    // ‰ΩøÁî®MapÂ≠òÂÇ®ÈÄâ‰∏≠ÁöÑÈü≥È¢ëÔºå‰ª•messageId‰∏∫ÈîÆ
                                    selectedAudioMessages.set(messageId, {
                                        id: messageId,
                                        path: audioPath
                                    });
                                } else {
                                    // ‰ªéMap‰∏≠Âà†Èô§
                                    selectedAudioMessages.delete(messageId);
                                }

                                // Êõ¥Êñ∞ÂêàÂπ∂ÊåâÈíÆÁä∂ÊÄÅ
                                updateMergeButtonState();
                            });
                        }, 0);
                    }
                }

                chatHistoryElement.appendChild(messageElement);

                // ÊªöÂä®Âà∞Â∫ïÈÉ®
                chatHistoryElement.scrollTop = chatHistoryElement.scrollHeight;

                return messageElement;
            }

            // Êõ¥Êñ∞ÂêàÂπ∂ÊåâÈíÆÁä∂ÊÄÅ
            function updateMergeButtonState() {
                // Êõ¥Êñ∞ÈÄâ‰∏≠Èü≥È¢ëÊï∞ÈáèÊòæÁ§∫
                selectedAudioCount.textContent = selectedAudioMessages.size;

                // Ê†πÊçÆÈÄâ‰∏≠Êï∞ÈáèÊòæÁ§∫/ÈöêËóèÂêàÂπ∂Èù¢Êùø
                if (selectedAudioMessages.size > 0) {
                    mergeAudioPanel.classList.add('active');
                } else {
                    mergeAudioPanel.classList.remove('active');
                }

                // Ê†πÊçÆÈÄâ‰∏≠Êï∞ÈáèÂêØÁî®/Á¶ÅÁî®ÂêàÂπ∂ÊåâÈíÆ
                if (selectedAudioMessages.size < 2) {
                    mergeAudioButton.disabled = true;
                    mergeAudioButton.setAttribute('data-tooltip', 'Ëá≥Â∞ëÈúÄË¶ÅÈÄâÊã©‰∏§‰∏™Èü≥È¢ëÊñá‰ª∂');
                } else {
                    mergeAudioButton.disabled = false;
                    mergeAudioButton.setAttribute('data-tooltip', 'ÂêàÂπ∂ÈÄâ‰∏≠ÁöÑÈü≥È¢ëÊñá‰ª∂');
                }
            }

            // Ê∏ÖÈô§Èü≥È¢ëÈÄâÊã©
            function clearAudioSelection() {
                selectedAudioMessages.clear();
                document.querySelectorAll('.audio-select-checkbox').forEach(checkbox => {
                    checkbox.checked = false;
                });
                updateMergeButtonState();
            }

            // ÂêàÂπ∂ÈÄâ‰∏≠Èü≥È¢ë
            async function mergeSelectedAudio() {
                if (selectedAudioMessages.size < 2) {
                    updateStatus('Ëá≥Â∞ëÈúÄË¶ÅÈÄâÊã©‰∏§‰∏™Èü≥È¢ëÊñá‰ª∂ËøõË°åÂêàÂπ∂', 'error');
                    return;
                }

                const count = selectedAudioMessages.size;
                updateStatus(`Ê≠£Âú®ÂêàÂπ∂ ${count} ‰∏™Èü≥È¢ëÊñá‰ª∂ÔºåËØ∑Á®çÂÄô...`, 'info');

                try {
                    // Ëé∑ÂèñÈÄâ‰∏≠Èü≥È¢ëÁöÑÊñá‰ª∂Ë∑ØÂæÑ
                    const filePaths = Array.from(selectedAudioMessages.values()).map(item => item.path);

                    // Ë∞ÉÁî®‰∏ªËøõÁ®ãÂêàÂπ∂Èü≥È¢ëÊñá‰ª∂
                    const result = await window.electronAPI.mergeAudioFiles(filePaths);

                    if (result.success) {
                        // Ê∑ªÂä†ÂêàÂπ∂ÂêéÁöÑÈü≥È¢ëÊ∂àÊÅØÂà∞ËÅäÂ§©ËÆ∞ÂΩï
                        const messageElement = addMessageToChat(`Â∑≤ÂêàÂπ∂ ${count} ‰∏™Èü≥È¢ëÊñá‰ª∂`, 'system-merged', {
                            path: result.path,
                            filename: result.filename
                        });

                        // ÂàõÂª∫Èü≥È¢ëÊí≠ÊîæÂô®
                        const playerId = messageElement.querySelector('.audio-player').id;
                        const playButton = messageElement.querySelector('.play-button');
                        const progressBar = messageElement.querySelector('.audio-progress-filled');
                        const audioTime = messageElement.querySelector('.audio-time');
                        const checkbox = messageElement.querySelector('.audio-select-checkbox');

                        // ÂàõÂª∫HTML5 AudioÂØπË±°
                        const audio = new Audio(result.path);

                        // Â≠òÂÇ®Êí≠ÊîæÂô®Áä∂ÊÄÅ
                        audioPlayers.set(playerId, {
                            audio: audio,
                            isPlaying: false,
                            duration: 0
                        });

                        // Ëé∑ÂèñÈü≥È¢ëÊó∂Èïø
                        audio.addEventListener('loadedmetadata', () => {
                            const player = audioPlayers.get(playerId);
                            player.duration = audio.duration;
                            const minutes = Math.floor(audio.duration / 60);
                            const seconds = Math.floor(audio.duration % 60);
                            audioTime.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                        });

                        // Êí≠ÊîæÊåâÈíÆ‰∫ã‰ª∂
                        playButton.addEventListener('click', () => {
                            const player = audioPlayers.get(playerId);
                            if (audio.paused) {
                                // ÊöÇÂÅúÂÖ∂‰ªñÊ≠£Âú®Êí≠ÊîæÁöÑÈü≥È¢ë
                                audioPlayers.forEach(p => {
                                    if (p !== player && !p.audio.paused) {
                                        p.audio.pause();
                                        // Êõ¥Êñ∞ÂÖ∂‰ªñÊí≠ÊîæÊåâÈíÆÁöÑÊòæÁ§∫
                                        document.querySelectorAll('.play-button').forEach(btn => {
                                            if (btn !== playButton && btn.dataset.playing === 'true') {
                                                btn.textContent = '‚ñ∂';
                                                btn.dataset.playing = 'false';
                                            }
                                        });
                                    }
                                });

                                // Êí≠ÊîæÂΩìÂâçÈü≥È¢ë
                                player.audio.play();
                                playButton.textContent = '‚ùö‚ùö';
                                playButton.dataset.playing = 'true';
                                updateStatus(`Ê≠£Âú®Êí≠ÊîæÂêàÂπ∂ÂêéÁöÑËØ≠Èü≥...`);
                            } else {
                                // ÊöÇÂÅúÊí≠Êîæ
                                player.audio.pause();
                                playButton.textContent = '‚ñ∂';
                                playButton.dataset.playing = 'false';
                                updateStatus('Êí≠ÊîæÂ∑≤ÊöÇÂÅú');
                            }
                        });

                        // ÁõëÂê¨Êí≠ÊîæËøõÂ∫¶
                        audio.addEventListener('timeupdate', () => {
                            const player = audioPlayers.get(playerId);
                            if (player && player.duration > 0) {
                                const progress = (audio.currentTime / player.duration) * 100;
                                progressBar.style.width = progress + '%';

                                // Êõ¥Êñ∞Êó∂Èó¥ÊòæÁ§∫
                                const currentMinutes = Math.floor(audio.currentTime / 60);
                                const currentSeconds = Math.floor(audio.currentTime % 60);
                                audioTime.textContent = `${currentMinutes.toString().padStart(2, '0')}:${currentSeconds.toString().padStart(2, '0')}`;
                            }
                        });

                        // ÁõëÂê¨Êí≠ÊîæÂÆåÊàê
                        audio.addEventListener('ended', () => {
                            playButton.textContent = '‚ñ∂';
                            playButton.dataset.playing = 'false';
                            updateStatus('Êí≠ÊîæÂÆåÊàê', 'success');
                        });

                        // Ê∑ªÂä†Èü≥È¢ëÈÄâÊã©Â§çÈÄâÊ°Ü‰∫ã‰ª∂ÁõëÂê¨Âô®
                        checkbox.addEventListener('change', (e) => {
                            const messageId = e.target.dataset.messageId;
                            const audioPath = e.target.dataset.audioPath;

                            if (e.target.checked) {
                                selectedAudioMessages.set(messageId, {
                                    id: messageId,
                                    path: audioPath
                                });
                            } else {
                                selectedAudioMessages.delete(messageId);
                            }

                            // Êõ¥Êñ∞ÂêàÂπ∂ÊåâÈíÆÁä∂ÊÄÅ
                            updateMergeButtonState();
                        });

                        // Ê∏ÖÈô§ÈÄâÊã©
                        clearAudioSelection();

                        updateStatus('Èü≥È¢ëÂêàÂπ∂ÂÆåÊàêÔºåÁÇπÂáªÊí≠ÊîæÊåâÈíÆÊî∂Âê¨', 'success');
                    } else {
                        throw new Error(result.error);
                    }
                } catch (error) {
                    console.error('ÂêàÂπ∂Èü≥È¢ëÊñá‰ª∂Â§±Ë¥•:', error);
                    updateStatus('ÂêàÂπ∂Èü≥È¢ëÊñá‰ª∂Â§±Ë¥•: ' + error.message, 'error');
                }
            }

            // ‰∏ãËΩΩÈü≥È¢ëÊñá‰ª∂
            function downloadAudio(filePath, filename) {
                // ÂàõÂª∫‰∏Ä‰∏™ÈöêËóèÁöÑ‰∏ãËΩΩÈìæÊé•
                const link = document.createElement('a');
                link.href = filePath;
                link.download = filename || 'tts-audio.mp3';
                link.style.display = 'none';

                // Ê∑ªÂä†Âà∞È°µÈù¢Âπ∂Ëß¶Âèë‰∏ãËΩΩ
                document.body.appendChild(link);
                link.click();

                // Ê∏ÖÁêÜ
                document.body.removeChild(link);

                updateStatus('Èü≥È¢ëÊñá‰ª∂‰∏ãËΩΩÂ∑≤ÂºÄÂßã', 'success');
            }

            // ÊñáÂ≠óËΩ¨ËØ≠Èü≥
            async function textToSpeech(text, voice) {
                try {
                    // ÊòæÁ§∫Ê≠£Âú®ËΩ¨Êç¢Áä∂ÊÄÅ
                    updateStatus('Ê≠£Âú®ËΩ¨Êç¢ÊñáÂ≠ó‰∏∫ËØ≠Èü≥...', 'info');

                    // Ë∞ÉÁî®‰∏ªËøõÁ®ãËøõË°åÊñáÂ≠óËΩ¨ËØ≠Èü≥
                    const result = await window.electronAPI.textToSpeech(text, voice);

                    if (result.success) {
                        // Ê∑ªÂä†ËØ≠Èü≥Ê∂àÊÅØÂà∞ËÅäÂ§©ËÆ∞ÂΩï
                        const messageElement = addMessageToChat(`Â∑≤Â∞Ü"${text}"ËΩ¨Êç¢‰∏∫ËØ≠Èü≥`, 'system', {
                            path: result.path,
                            filename: result.filename
                        });

                        // ÂàõÂª∫Èü≥È¢ëÊí≠ÊîæÂô®
                        const playerId = messageElement.querySelector('.audio-player').id;
                        const playButton = messageElement.querySelector('.play-button');
                        const progressBar = messageElement.querySelector('.audio-progress-filled');
                        const audioTime = messageElement.querySelector('.audio-time');
                        const checkbox = messageElement.querySelector('.audio-select-checkbox');

                        // ÂàõÂª∫HTML5 AudioÂØπË±°
                        const audio = new Audio(result.path);

                        // Â≠òÂÇ®Êí≠ÊîæÂô®Áä∂ÊÄÅ
                        audioPlayers.set(playerId, {
                            audio: audio,
                            isPlaying: false,
                            duration: 0
                        });

                        // Ëé∑ÂèñÈü≥È¢ëÊó∂Èïø
                        audio.addEventListener('loadedmetadata', () => {
                            const player = audioPlayers.get(playerId);
                            player.duration = audio.duration;
                            const minutes = Math.floor(audio.duration / 60);
                            const seconds = Math.floor(audio.duration % 60);
                            audioTime.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                        });

                        // Êí≠ÊîæÊåâÈíÆ‰∫ã‰ª∂
                        playButton.addEventListener('click', () => {
                            const player = audioPlayers.get(playerId);
                            if (audio.paused) {
                                // ÊöÇÂÅúÂÖ∂‰ªñÊ≠£Âú®Êí≠ÊîæÁöÑÈü≥È¢ë
                                audioPlayers.forEach(p => {
                                    if (p !== player && !p.audio.paused) {
                                        p.audio.pause();
                                        // Êõ¥Êñ∞ÂÖ∂‰ªñÊí≠ÊîæÊåâÈíÆÁöÑÊòæÁ§∫
                                        document.querySelectorAll('.play-button').forEach(btn => {
                                            if (btn !== playButton && btn.dataset.playing === 'true') {
                                                btn.textContent = '‚ñ∂';
                                                btn.dataset.playing = 'false';
                                            }
                                        });
                                    }
                                });

                                // Êí≠ÊîæÂΩìÂâçÈü≥È¢ë
                                player.audio.play();
                                playButton.textContent = '‚ùö‚ùö';
                                playButton.dataset.playing = 'true';
                                updateStatus('Ê≠£Âú®Êí≠ÊîæËØ≠Èü≥...');
                            } else {
                                // ÊöÇÂÅúÊí≠Êîæ
                                player.audio.pause();
                                playButton.textContent = '‚ñ∂';
                                playButton.dataset.playing = 'false';
                                updateStatus('Êí≠ÊîæÂ∑≤ÊöÇÂÅú');
                            }
                        });

                        // ÁõëÂê¨Êí≠ÊîæËøõÂ∫¶
                        audio.addEventListener('timeupdate', () => {
                            const player = audioPlayers.get(playerId);
                            if (player && player.duration > 0) {
                                const progress = (audio.currentTime / player.duration) * 100;
                                progressBar.style.width = progress + '%';

                                // Êõ¥Êñ∞Êó∂Èó¥ÊòæÁ§∫
                                const currentMinutes = Math.floor(audio.currentTime / 60);
                                const currentSeconds = Math.floor(audio.currentTime % 60);
                                audioTime.textContent = `${currentMinutes.toString().padStart(2, '0')}:${currentSeconds.toString().padStart(2, '0')}`;
                            }
                        });

                        // ÁõëÂê¨Êí≠ÊîæÂÆåÊàê
                        audio.addEventListener('ended', () => {
                            playButton.textContent = '‚ñ∂';
                            playButton.dataset.playing = 'false';
                            updateStatus('Êí≠ÊîæÂÆåÊàê', 'success');
                        });

                        // Ê∑ªÂä†Èü≥È¢ëÈÄâÊã©Â§çÈÄâÊ°Ü‰∫ã‰ª∂ÁõëÂê¨Âô®
                        checkbox.addEventListener('change', (e) => {
                            const messageId = e.target.dataset.messageId;
                            const audioPath = e.target.dataset.audioPath;

                            if (e.target.checked) {
                                selectedAudioMessages.set(messageId, {
                                    id: messageId,
                                    path: audioPath
                                });
                            } else {
                                selectedAudioMessages.delete(messageId);
                            }

                            // Êõ¥Êñ∞ÂêàÂπ∂ÊåâÈíÆÁä∂ÊÄÅ
                            updateMergeButtonState();
                        });

                        updateStatus('ËΩ¨Êç¢ÂÆåÊàêÔºåÁÇπÂáªÊí≠ÊîæÊåâÈíÆÊî∂Âê¨', 'success');
                    } else {
                        throw new Error(result.error);
                    }
                } catch (error) {
                    console.error('ÊñáÂ≠óËΩ¨ËØ≠Èü≥Â§±Ë¥•:', error);
                    updateStatus('ËØ≠Èü≥ËΩ¨Êç¢Â§±Ë¥•: ' + error.message, 'error');
                }
            }

            // Êõ¥Êñ∞Áä∂ÊÄÅÊ†è
            function updateStatus(text, type = 'info') {
                statusElement.textContent = text;
                statusElement.className = 'status';

                if (type === 'error') {
                    statusElement.classList.add('error');
                } else if (type === 'success') {
                    statusElement.classList.add('success');
                }
            }
        });
    </script>
</body>

</html>